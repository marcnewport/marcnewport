var PanelNotes=Panel.extend({init:function(){this.id="notes";this._super()},open:function(){this.setup();this._super()},setup:function(){var scope=this;$("#panel-notes").find(".tab").bind("click",function(p_event){switch(p_event.target.id){case"my-notes":scope.showMyNotes();break;case"action-notes":scope.showActionNotes();break;case"other-notes":scope.showOtherNotes();break}p_event.preventDefault()});if($("#btn-print").length<=0){$("#panel-notes").append($$("a","btn-print","button",{href:"#"}).html("Print").click(this.printNotes))}this.showMyNotes();this._super()},showMyNotes:function(){var l_role=_app.session.getUserData("role")[1]||"all",l_pages=_app.structure.course.settings.page_list[l_role].replace(/\s/g,"").split(","),l_pageCount=l_pages.length,l_pageId="",l_pageType="",l_comments=[],l_notes=_app.session.get("comments")||[],l_count=l_notes.length,l_foundNotes=false,l_topic="",l_nextTopic="",l_pageData={},$html=$$("div","","inner"),$section=[],l_questions=[],l_questionCount=0,l_message="";$("#panel-notes").find(".tab").each(function(){var $this=$(this);$this.removeClass("selected");if($this.attr("id")=="my-notes"){$this.addClass("selected")}});if(l_count){for(var i=0;i<l_pageCount;i++){l_pageId=l_pages[i];l_pageType=_app.structure.type(l_pages[i]);if(["mp_free_text","mp_audio_stories","mp_reflect_and_review"].indexOf(l_pageType)>=0){l_comments=_app.session.getComments(l_pageId);if(l_comments.length){l_nextTopic=_app.structure.parent(l_pageId).title;if(l_nextTopic!==l_topic){$html.append($$("h2").html(l_nextTopic));l_topic=l_nextTopic}if(l_pageId===_app.currentPage.id){l_pageData=_app.currentPage.data}else{l_pageData=_app.sequence.getData(l_pageId)}$section=$$("div","note-"+l_pageId,"note-section");l_questions=l_pageData.questions?$.makeArray(l_pageData.questions.question):$.makeArray(l_pageData.question);l_questionCount=l_questions.length;$section.append($$("h5").html(l_pageData.title)).append($$("div","","scenario").html(l_pageData.scenario));for(var j=0;j<l_questionCount;j++){$section.append($$("div","","question").html(l_questions[j].text[0])).append($$("div","","response").html(l_comments[j]||"No comment."))}if(l_pageType==="mp_reflect_and_review"){var tabs=$.makeArray(l_pageData.tabs.tab),tabCount=tabs.length;for(var k=0;k<tabCount;k++){if(tabs[k].question){$section.append($$("div","","question").html(tabs[k].question)).append($$("div","","response").html(l_comments[0]||"No comment."))}}}$html.append($section)}}}}l_message="<p>As you work through this module, your answers to free text questions will be saved here. You must remember to print these before you exit the module.</p>";if(_app.structure.course.my_notes_text){l_message=_app.structure.course.my_notes_text}$html.prepend(l_message);$("#panel-notes").find(".panel-content").html($html)},showActionNotes:function(){var $textarea=$$("textarea","action-notes-field","notes-field",{name:"action-notes-field"}),l_comments=_app.session.getComments("actions"),l_comment=l_comments[0]||"Enter text here",l_limit=4e3,l_message='<label for="action-notes-field">Use this space to note down anything you would like to follow up later. You must remember to print these before you exit the module.</label>';if(_app.structure.course.action_notes_text){l_message=_app.structure.course.action_notes_text}$("#panel-notes").find(".tab").each(function(){var $this=$(this);$this.removeClass("selected");if($this.attr("id")=="action-notes"){$this.addClass("selected")}});$("#panel-notes").find(".panel-content").html($$("div","","inner").append($$("p").html(l_message)).append($textarea.val(l_comment.carriage())));$textarea.bind("keyup",function(){var $this=$(this),l_text=$this.val();if(l_text.length>l_limit){$this.val(l_text.substr(0,l_limit))}}).bind("focus",function(){if($textarea.val()==="Enter text here"){$textarea.val("")}}).bind("blur",function(){var l_input=$textarea.val();if(l_input===""){$textarea.val("Enter text here")}if(l_input.length>l_limit){l_input=l_input.substr(0,l_limit)}_app.session.setComments("actions",l_input.uncarriage())})},showOtherNotes:function(){var $textarea=$$("textarea","other-notes-field","notes-field",{name:"other-notes-field"}),l_comments=_app.session.getComments("other"),l_comment=l_comments[0]||"Enter text here",l_limit=4e3,l_message='<label for="other-notes-field">Use this space to capture any other notes you wish to save. You must remember to print these before you exit the module.</label>';if(_app.structure.course.other_notes_text){l_message=_app.structure.course.other_notes_text}$("#panel-notes").find(".tab").each(function(){var $this=$(this);$this.removeClass("selected");if($this.attr("id")=="other-notes"){$this.addClass("selected")}});$("#panel-notes").find(".panel-content").html($$("div","","inner").append($$("p").html(l_message)).append($textarea.val(l_comment.carriage())));$textarea.bind("keyup",function(){var $this=$(this),l_text=$this.val();if(l_text.length>l_limit){$this.val(l_text.substr(0,l_limit))}}).bind("focus",function(){if($textarea.val()=="Enter text here"){$textarea.val("")}}).bind("blur",function(){var l_input=$textarea.val();if(l_input===""){$textarea.val("Enter text here")}if(l_input.length>l_limit){l_input=l_input.substr(0,l_limit)}_app.session.setComments("other",l_input.uncarriage())})},printNotes:function(p_event){var l_window={},l_notes=_app.session.get("comments")||[],l_count=l_notes.length,l_topic="",l_pageData={},l_actionNotes="There are no notes entered for this section",l_otherNotes="There are no notes entered for this section",$html=$$("div","printable-notes");for(var i=0;i<l_count;i++){switch(l_notes[i][0]){case"actions":l_actionNotes=l_notes[i][1];break;case"other":l_otherNotes=l_notes[i][1];break;default:if(l_topic!=_app.structure.parent(l_notes[i][0]).title){l_topic=_app.structure.parent(l_notes[i][0]).title;$html.append($$("h1").html(l_topic))}if(l_notes[i][0]==_app.currentPage.id){l_pageData=_app.currentPage.data}else{l_pageData=_app.sequence.getData(l_notes[i][0])}var $noteSection=$$("div","note-"+l_notes[i][0],"note-section"),l_questions=l_pageData.questions?$.makeArray(l_pageData.questions.question):$.makeArray(l_pageData.question),l_questionCount=l_questions.length,l_noteText="";$noteSection.append($$("h3").html(l_pageData.title)).append($$("div","","scenario").html(l_pageData.scenario));for(var j=0;j<l_questionCount;j++){l_noteText=l_notes[i][1][j];l_noteText="<em>"+l_noteText+"</em>";$noteSection.append($$("div","","question").html(l_questions[j].text[0])).append('<div style="font-style:italic;padding-left:20px;border-left: 3px solid #d2d2d2;margin:15px 0;">'+l_noteText+"</div>")}if(l_pageData.type==="mp_reflect_and_review"){var tabs=$.makeArray(l_pageData.tabs.tab),tabCount=tabs.length;for(var k=0;k<tabCount;k++){if(tabs[k].question){l_noteText=l_notes[i][1];l_noteText="<em>"+l_noteText+"</em>";$noteSection.append($$("div","","question").html(tabs[k].question)).append('<div style="font-style:italic;padding-left:20px;border-left: 3px solid #d2d2d2;margin:15px 0;">'+l_noteText+"</div>")}}}$html.append($noteSection);break}}if(l_count<1){$html.append('<h1>My notes</h1><div style="font-style:italic;padding-left:20px;border-left: 3px solid #d2d2d2;margin:15px 0;">There are no notes entered for this section</div>')}$html.append('<h1>Actions</h1><div style="font-style:italic;padding-left:20px;border-left: 3px solid #d2d2d2;margin:15px 0;">'+l_actionNotes+"</div>").append('<h1>Other notes</h1><div style="font-style:italic;padding-left:20px;border-left: 3px solid #d2d2d2;margin:15px 0;">'+l_otherNotes+"</div>");$html.wrapInner($$("div","printable").css("font-family","Arial, Sans-serif"));l_window=window.open("/notes.html");l_window.document.write($html.html());l_window.focus();l_window.location.reload();l_window.print();l_window.close();p_event.preventDefault()}});