var mp_checklist=PageType.extend({setup:function(){this.$rightColumn=$$("div","","right-column");this.$leftColumn=$$("div","","left-column");this.hasMedia=this.data.media?true:false;var l_responses=$.makeArray(this.data.responses.item),l_count=l_responses.length,$responses=$$("fieldset","activity"),$response=[];$responses.append($$("legend","","hidden").html("Activity"));for(var i=0;i<l_count;i++){$response=$$("div","r-"+i,"response");if(l_responses[i].why){$response.append($$("a","","btn-why w-"+i,{href:"#",title:"Find out why"}).html("?"));this.whyFeedback=true}$response.append($$("label").attr("for","i-"+i).append(l_responses[i].option)).append($$("checkbox","i-"+i).attr({name:"i-"+i})).append($$("span","","custom-input"));$responses.append($response)}if(empty(this.data.scenario)&&!this.hasMedia){this.html.append(this.$rightColumn.append($$("div","question").html(this.data.question)).append($responses).append($$("a","btn-submit").attr({href:"#",role:"button"}).html("Submit")))}else{this.$leftColumn.append($$("div","scenario").html(this.data.scenario));if(this.hasMedia){this.$leftColumn.append($$("div","media-holder-"+this.id,"media-holder"));if(this.data.media.item.description)_app.$page.addClass("transcript")}this.html.append(this.$leftColumn).append(this.$rightColumn.append($$("div","question").html(this.data.question)).append($responses).append($$("a","btn-submit").attr({href:"#",role:"button"}).html("Submit")))}this._super()},pageReady:function(){var l_scenarioLess=empty(this.data.scenario)?true:false,$activity=$("#activity"),$inputs=$activity.find("input"),l_userData=_app.session.getUserData(this.id),l_dimensions={},l_description="",l_maxMediaWidth=385;if(l_scenarioLess){this.$leftColumn.hide();this.$rightColumn.addClass("no-scenario")}if(this.hasMedia){this.media=this.data.media.item;switch(this.media.type){case"mp_resource_video":this.media.width=l_maxMediaWidth;this.media.height=Math.floor(this.media.width*(9/16));_app.setupVideoPlayer("media-holder-"+this.id,this.media);break;case"mp_resource_audio":this.media.width=l_maxMediaWidth;if(this.media.image){this.media.height=Math.floor(this.media.width*(9/16))}else{this.media.height=24}_app.setupAudioPlayer("media-holder-"+this.id,this.media,this.media.image);break;case"mp_resource_image":$("#media-holder-"+this.id).html($$("img","","",{src:"files/"+this.media.content}));break}l_dimensions={width:this.media.width,height:120};l_description=this.media.description||"";if(!empty(l_description)){this.$leftColumn.append($$("div").html(l_description).transcript("down",l_dimensions,this.media.id))}this.$leftColumn.css({width:l_maxMediaWidth+"px",marginRight:"15px",height:"95%"});this.$rightColumn.css({width:"auto","float":"none"})}if(l_userData[2]){$inputs.each(function(i){if(Boolean(l_userData[2][i])){$(this).prop("checked",true)}})}this._super();this.setupActivity()},setupActivity:function(){var $activity=$("#activity"),$submit=$("#btn-submit");$submit.disable();$activity.bind("change",function(e){if($activity.find("input:checked").length){$submit.enable()}else{$submit.disable()}})},submitAnswers:function(){this.attempts++;_app.pausePlayers();var $activity=$("#activity"),$responses=$activity.find(".response"),l_answers=$.makeArray(this.data.responses.item),l_userData=[],l_correct=true,l_classes="",l_finalRound=this.attempts>=this.data.max_attempts;$("#btn-submit").disable();$responses.find("input").attr("disabled","true").each(function(i){if(this.checked){l_userData[i]=1;if(!Number(l_answers[i].correct)){l_correct=false}}else{l_userData[i]=0;if(Number(l_answers[i].correct)){l_correct=false}}l_classes=l_userData[i]?"checked":"";l_classes+=Number(l_answers[i].correct)?" correct":"";$responses.eq(i).addClass(l_classes)});if(l_finalRound||l_correct){$activity.addClass("completed")}else{$responses.removeClass("checked correct");$activity.addClass("disabled")}this.updatePageData([Number(l_correct),l_userData,this.attempts])},resetActivity:function(){this._super();_app.$content.find("#activity").removeClass("disabled completed").find(".response").removeClass("checked correct").find("input").removeAttr("disabled").prop("checked",false).unbind("change");this.setupActivity()},resizePage:function(){var $pageTitle=_app.$content.find(".page-title"),$inner=_app.$content.find(".inner"),l_margin=$inner.outerHeight(true)-$inner.outerHeight(),l_outer=$pageTitle.outerHeight(true)+l_margin,$leftColumn=_app.$content.find(".left-column"),lc_margin=parseInt($leftColumn.css("margin-bottom"),10),$question=_app.$content.find("#question"),$scenario=_app.$content.find("#scenario"),q_margin=parseInt($question.css("margin-bottom"),10),$activity=_app.$content.find("#activity"),a_margin=parseInt($activity.css("margin-bottom"),10),rc_margin=parseInt($inner.find(".right-column").css("margin-bottom"),10),l_height=_app.$content.height(),l_mediaHeight=0,l_submit=_app.$content.find("#btn-submit").outerHeight(),l_availableHeight=l_height-l_outer-l_submit-q_margin-a_margin-rc_margin,l_questionHeight=Math.floor(.5*l_availableHeight),l_activityHeight=Math.floor(.5*l_availableHeight);if(empty(this.data.scenario)){l_outer+=$question.outerHeight(true)}if(this.hasMedia){l_mediaHeight=this.data.media.item.height;if(this.data.media.item.description)l_mediaHeight+=78;$scenario.css({maxHeight:l_height-l_outer-lc_margin-l_mediaHeight-15,paddingRight:"15px",overflow:"auto"})}else{this.$leftColumn.css({maxHeight:l_height-l_outer-lc_margin,paddingRight:"15px",overflow:"auto"})}if($question.get(0).scrollHeight<Math.floor(.333*l_availableHeight)){l_questionHeight=$question.get(0).scrollHeight;l_activityHeight=l_availableHeight-l_questionHeight}else if($activity.get(0).scrollHeight>Math.floor(.666*l_availableHeight)){l_questionHeight=Math.floor(.333*l_availableHeight);l_activityHeight=Math.floor(.666*l_availableHeight)}else{l_activityHeight=$activity.get(0).scrollHeight;l_questionHeight=l_availableHeight-l_activityHeight}$question.css({maxHeight:l_questionHeight,overflow:"auto"});$activity.css({maxHeight:l_activityHeight,overflow:"auto"});if(!$activity.hasVerticalScroll()){$activity.css("padding-right","17px")}}});