var mp_click_scene=PageType.extend({setup:function(){$.loadScript("js/page_types/mp_hotspot_activity.js");$.loadScript("js/page_types/mp_hotspot_multiple_choice.js");this.hotspot={};this.$scene=$$("div","scene","",{role:"listbox"});this.activityIndex=0;this.hotspotActivity={};this.userData=_app.session.getUserData(this.id)[2]||{};var l_image=this.data.asset.item,l_hotspots=$.makeArray(this.data.hotspots.item),l_hsCount=l_hotspots.length,$image=$$("img").attr({src:"files/"+l_image.content,alt:l_image.alt_text+" Select each clickable within the image.",width:l_image.width,height:l_image.height}),l_classes="";this.hotspots=l_hotspots;this.$scene.append($image);for(var i=0;i<l_hsCount;i++){if(empty(this.userData[l_hotspots[i].id])){this.userData[l_hotspots[i].id]=[0,0];l_classes="hotspot"}else if(this.userData[l_hotspots[i].id][0]===0){this.userData[l_hotspots[i].id][0]=0;l_classes="hotspot"}else{l_classes="hotspot complete"}this.$scene.append($$("a",l_hotspots[i].id,l_classes,{href:"#",role:"option"}).css({position:"absolute",top:l_hotspots[i].top+"px",left:l_hotspots[i].left-4+"px"}).html(l_hotspots[i].title))}this.html.append($$("div","main-text").html(this.data.main)).append(this.$scene);this._super()},pageReady:function(){this._super();var scope=this,$reset=[];this.$scene.bind("click",function(event){var $target=$(event.target);_app.$content.find("#hs-popup").fadeOut(400,function(){$(this).remove();this.hotspot={}});if($target.hasClass("hotspot")&&!$target.hasClass("complete")){scope.hotspotClicked($target.attr("id"))}return false});if(this.reviewMode){$reset=$$("a","btn-reset","reset question",{href:"#"}).html("Reset");$("#scene").append($reset);$reset.click(function(){_app.session.setUserData([scope.id,undefined,undefined]);_app.sequence.goTo(scope.id);return false});$("#btn-page-navigation-next").enable()}},resizePage:function(){var $pageTitle=_app.$content.find(".page-title"),$inner=_app.$content.find(".inner"),l_margin=$inner.outerHeight(true)-$inner.outerHeight(),l_outer=$pageTitle.height()+l_margin,$main=_app.$content.find("#main-text"),$scene=_app.$content.find("#scene"),l_height=_app.$content.height(),l_width=_app.$content.find(".inner").width(),l_imageWidth=$scene.find("img").attr("width");$main.css({maxHeight:l_height-l_outer,width:l_width-l_imageWidth-12,overflow:"auto"});$scene.css({maxHeight:l_height-l_outer,overflow:"hidden"})},hotspotClicked:function(p_id){var l_hsCount=this.hotspots.length,l_hotspot={};for(var i=0;i<l_hsCount;i++){if(this.hotspots[i].id==p_id){l_hotspot=this.hotspots[i];break}}if(this.userData[l_hotspot.id]){this.activityIndex=this.userData[l_hotspot.id][1]||0}this.hotspot=l_hotspot;this.showHotspotActivity()},showHotspotActivity:function(){var l_activities=$.makeArray(this.hotspot.activities.item),l_activity=l_activities[this.activityIndex],l_id=l_activity.id,l_type=l_activity.type,l_data=_app.sequence.getData(l_id);_app.$page.find("#hs-popup").remove();this.HotspotActivity=new window[l_type](l_data);this.userData[this.hotspot.id][1]=this.activityIndex},hotspotCompleted:function(){var l_completed=1;this.userData[this.hotspot.id][0]=1;for(var a in this.userData){if(this.userData[a][0]<1){l_completed=0;break}}if(l_completed){$("#btn-page-navigation-next").enable();_app.panels.menu.pageComplete(this.id)}_app.session.setUserData([this.id,l_completed,this.userData]);this.hotspot={};this.activityIndex=0}});