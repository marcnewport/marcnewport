var mp_role_choice=PageType.extend({setup:function(){var $main=$$("div","main-text"),$img=[],$roles=$$("div","roles"),l_roles=$.makeArray(this.data.roles.item),l_count=l_roles.length,l_role=_app.session.getUserData("role")[1]||false,l_classes="";for(var i=0;i<l_count;i++){l_classes="role-item";if(l_roles[i].id===l_role){l_classes+=" selected";_app.$footer.find("#btn-page-navigation-next").enable()}$img=$$("img").attr({src:"files/"+l_roles[i].image.item.content,alt:l_roles[i].image.item.alt_text,width:l_roles[i].image.item.width,height:l_roles[i].image.item.height});$roles.append($$("div",l_roles[i].id,l_classes).append($$("a").attr({href:"#",title:l_roles[i].name}).append($img)).append($$("h3").html(l_roles[i].name)))}$main.html(this.data.main);this.html.append($main).append($roles);this._super()},pageReady:function(){this._super();var scope=this,$roles=_app.$content.find("#roles"),l_roles=$.makeArray(this.data.roles.item),l_count=l_roles.length;$roles.bind("click",function(p_event){var $target=$(p_event.target).parents(".role-item"),l_role=_app.session.getUserData("role"),l_selected=$target.attr("id"),l_position=[];if(l_role&&l_role!==l_selected){_app.session.set("cmi.core.lesson_status","incomplete");_app.scorm.save()}$roles.find(".role-item").removeClass("selected");$target.addClass("selected");_app.session.setUserData(["role",l_selected]);l_position=_app.structure.getPosition(scope.id);_app.$footer.find(".page-navigation-position").html(l_position[0]+"/"+l_position[1]);_app.panels.menu.setup();_app.$footer.find("#btn-page-navigation-next").enable();p_event.preventDefault()});$roles.find(".role-item").each(function(index){var $this=$(this),l_description;for(var i=0;i<l_count;i++){if(i===index){l_description=l_roles[i].description;break}}if(l_description){$this.hover(function(){$this.tooltip(l_description)},function(){$(".tooltip").remove()})}})},resizePage:function(){var l_count=$.makeArray(this.data.roles.item).length,$inner=_app.$content.find(".inner").eq(0),$pageTitle=$inner.find(".page-title"),$main=$inner.find("#main-text"),$roles=$inner.find("#roles"),l_width=$inner.width(),l_height=$inner.height()-$pageTitle.height(),l_margin=0,l_mainWidth=0,l_rolesWidth=0,l_imageWidth=0,l_rolesMargin=0;if(l_count<4){if(this.data.main)l_mainWidth=l_width/(l_count+1);l_rolesWidth=l_width-l_mainWidth;l_imageWidth=l_rolesWidth/l_count-l_margin}else{if(this.data.main)l_mainWidth=l_width/(Math.ceil(l_count/2)+1);l_rolesWidth=l_width-l_mainWidth;l_imageWidth=Math.floor(l_rolesWidth/Math.ceil(l_count/2))-l_margin;l_rolesMargin="-30px"}$main.css({width:l_mainWidth,maxHeight:l_height});$roles.css({width:l_rolesWidth,marginTop:l_rolesMargin}).find(".role-item").css({width:l_imageWidth}).find("a").css({width:l_imageWidth-50,height:l_imageWidth-50,marginLeft:"15px"}).end().find("img").scaleDimensions({width:l_imageWidth-50,height:l_imageWidth-50,fill:true})}});