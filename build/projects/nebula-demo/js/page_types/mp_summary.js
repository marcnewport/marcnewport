var mp_summary=PageType.extend({setup:function(){this.hasMedia=false;this.score={};this.updatePageData();var l_scoreData=[],$leftColumn=$$("div","","left-column"),$summaryButtons=$$("div","summary-buttons"),$rightColumn=$$("div","","right-column"),l_summaryText="You have not completed the module yet.",l_summaryImage="",l_useImage=this.data.include_image,l_customPassImage=this.data.pass_image,l_customFailImage=this.data.fail_image;_app.session.checkCompletion();l_scoreData=_app.session.getUserData("score")||["score",0,0,0];this.score={raw:l_scoreData[1],max:l_scoreData[2],percent:l_scoreData[3]};if(this.score.percent>=_app.structure.course.settings.pass_mark){l_summaryText=this.data.pass_text;if(l_useImage){if(l_customPassImage){l_summaryImage="files/"+l_customPassImage.item.content}else{l_summaryImage="files/skin/summary-pass.jpg"}}}else{l_summaryText=this.data.fail_text;if(l_useImage){if(l_customFailImage){l_summaryImage="files/"+l_customFailImage.item.content}else{l_summaryImage="files/skin/summary-fail.jpg"}}}$summaryButtons.append($$("h4").html(this.data.button_heading));if(Number(this.data.reviewable)){$summaryButtons.append($$("a","btn-review").attr("href","#").html(this.data.btn_review||"Review module"))}$summaryButtons.append($$("a","btn-page-exit").attr("href","#").html(this.data.btn_exit||"Exit module"));$leftColumn.append(l_summaryText).append($summaryButtons);if(this.data.media){if(this.data.media.title){$rightColumn.append($$("h2","media-title").html(this.data.media.title))}else{$rightColumn.append($$("div","media-title").html("Â "))}var $media=$$("div","media-player-"+this.id,"summary-media"),l_media=this.data.media.item||{};if(l_media.type==="mp_resource_image"){$media.html($$("img").attr({src:"files/"+l_media.content,width:l_media.width,height:l_media.height,alt:l_media.alt_text}))}$rightColumn.append($media);_app.$content.addClass("has-media");this.hasMedia=true}else{if(l_useImage){$rightColumn.append($$("img").attr({src:l_summaryImage,alt:""}))}if(this.data.directors_tip){$rightColumn.append($$("div","","directors-tip").append($$("h5").html(this.data.summary_title)).append(this.data.directors_tip))}}this.html.append($leftColumn).append($rightColumn);this._super()},pageReady:function(){this._super();var l_media={},l_dimensions={width:373,height:120},l_showScore=this.data.show_score?this.data.show_score:false,l_description="";if(l_showScore){switch(l_showScore){case"total":_app.$content.addClass("has-score").find(".right-column").prepend($$("div","user-score","total").html($$("h2").html("your score: "+this.score.raw+"/"+this.score.max)));this.hasScore=true;break;case"percent":_app.$content.addClass("has-score").find(".right-column").prepend($$("div","user-score","percent").html($$("h2").html("your score:<span> "+this.score.percent+"%</span>")));this.hasScore=true;break}}if(this.hasMedia){l_media=this.data.media.item;l_media.width=373;l_media.height=210;switch(l_media.type){case"mp_resource_image":l_description="";break;case"mp_resource_video":l_description=l_media.description||"";_app.setupVideoPlayer("media-player-"+this.id,l_media);break;case"mp_resource_audio":l_description=l_media.description||"";if(l_media.image){_app.setupAudioPlayer("media-player-"+this.id,l_media,l_media.image)}else{_app.setupAudioPlayer("media-player-"+this.id,l_media);l_dimensions.height=300}break}if(!empty(l_description)){_app.$content.find(".right-column").append($$("div").html(l_description).transcript("down",l_dimensions,this.playerId))}}_app.$content.find("#summary-buttons").click(function(p_event){switch(p_event.target.id){case"btn-review":_app.sequence.goTo(_app.structure.firstViewableChild(_app.structure.getTopics()[0].id).id);break;case"btn-page-exit":_app.sequence.exit();break}p_event.preventDefault()});_app.scorm.save()},resizePage:function(){var $pageTitle=_app.$content.find(".page-title"),$inner=_app.$content.find(".inner"),l_margin=$inner.outerHeight(true)-$inner.outerHeight(),l_outer=$pageTitle.outerHeight(true)+l_margin,$leftColumn=_app.$content.find(".left-column"),lc_margin=parseInt($leftColumn.css("margin-bottom"),10),$rightColumn=_app.$content.find(".right-column"),rc_margin=parseInt($rightColumn.css("margin-bottom"),10),rc_marginTop=this.hasScore?62:30,l_height=_app.$content.height(),rc_maxHeight=l_height-l_outer-rc_margin+rc_marginTop,y_margin=$inner.outerWidth(true)-$inner.outerWidth(),l_width=_app.$content.width(),l_media={},rc_maxWidth=585,rc_width=0;$leftColumn.css({maxHeight:l_height-l_outer-lc_margin,width:l_width-y_margin-20-$rightColumn.outerWidth(true),overflow:"auto"});$rightColumn.css({maxHeight:rc_maxHeight,overflow:"auto",marginTop:rc_marginTop*-1+"px"});if(this.data.media&&this.data.media.item){l_media=this.data.media.item;if(l_media.type==="mp_resource_image"){if(l_media.width>rc_maxWidth){rc_width=rc_maxWidth;$rightColumn.width(rc_width).find("img").scaleDimensions({width:rc_width,height:rc_maxHeight,fill:true})}else{rc_width=l_media.width;$rightColumn.width(rc_width)}$leftColumn.width(rc_width-$inner.width()-20)}}if(l_height>rc_maxHeight&&this.hasScore){$rightColumn.css({paddingRight:"15px"})}}});