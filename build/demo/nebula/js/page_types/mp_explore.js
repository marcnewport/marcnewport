var mp_explore=PageType.extend({setup:function(){var l_items=this.data.information.item,l_itemCount=l_items.length,$main=$$("div","main-text"),$leftColumn=$$("div","","left-column"),$list=$$("ul"),$link=[],$innerWrap=$$("div","","inner-wrap"),$panel=[],l_userData=_app.session.getUserData(this.id)[2]||[],l_lastViewed=0,l_classes="",$image=[];$main.html(this.data.main);for(var i=0;i<l_itemCount;i++){$image=[];l_classes="link";if(l_userData[i]){this.data.information.item[i].viewed=l_userData[i];l_classes+=" viewed";l_lastViewed=i}else{this.data.information.item[i].viewed=0}$link=$$("a","link-"+i,l_classes,{href:"#"}).html(l_items[i].label.stripTags());$list.append($$("li").html($link));$panel=$$("div","panel-"+i,"panel hidden").append($$("h4").html(l_items[i].label.stripTags())).append(l_items[i].text[0]);if(!empty(l_items[i].image)){$image=$$("img").attr({src:"files/"+l_items[i].image.path,alt:l_items[i].image.alt_text||"",width:l_items[i].image.width,height:l_items[i].image.height});$panel.append($image)}else if(!empty(this.data.image)){$image=$$("img").attr({src:"files/"+this.data.image.path,alt:this.data.image.alt_text||"",width:this.data.image.width,height:this.data.image.height});$panel.append($image)}$innerWrap.append($panel)}this.data.information.item[l_lastViewed].viewed=1;$list.find("#link-"+l_lastViewed).addClass("active viewed");$innerWrap.find("#panel-"+l_lastViewed).css("display","block");this.html.append($main).append($leftColumn.html($list)).append($$("div","","right-column").html($innerWrap));this._super()},pageReady:function(){var scope=this,$leftColumn=_app.$content.find(".left-column");$leftColumn.bind("click",function(p_event){var $target=$(p_event.target),$panel=[],l_top=0,t_top=0,t_height=0,l_item="";if($target.is("span")){$target=$target.parent()}if($target.is("a")){l_item=$target.attr("id");l_item=l_item.split("-")[1];$leftColumn.find(".active").removeClass("active");$target.addClass("active viewed");_app.$content.find(".panel").removeAttr("style");$panel=_app.$content.find("#panel-"+l_item);t_top=$target.position().top;t_height=$target.height();l_top=t_top+t_height/2;l_top=l_top-($panel.actual("height")+30)/2;if(l_top<-15){l_top=-15}_app.$content.find(".right-column").css("margin-top",Math.round(l_top));$panel.fadeIn(500,function(){$panel.findFirstText().attr("tabindex","-1").focus();$(document).bind("keyup.explore",function(e){if(e.keyCode==9){var l_next=Number(l_item)+1;$("#link-"+l_next).focus();$(document).unbind("keyup.explore")}})});scope.data.information.item[l_item].viewed=1;if(scope.viewedAll()){$("#btn-page-navigation-next").enable()}}return false});this._super();if(this.viewedAll()){$("#btn-page-navigation-next").enable()}},resizePage:function(){var $inner=_app.$content.find(".inner").eq(0),$title=$inner.find(".page-title"),$main=$inner.find("#main-text"),l_height=$inner.height()-$title.height()-$main.height()-50,$rightInner=_app.$content.find(".right-column .inner-wrap"),l_width=$rightInner.width()-20;$rightInner.css({maxHeight:l_height,overflow:"auto",paddingRight:"10px"});$rightInner.find("img").scaleDimensions({width:l_width})},viewedAll:function(){var l_items=$.makeArray(this.data.information.item),l_count=l_items.length,l_userData=_app.session.getUserData(this.id)[2]||[],l_complete=true;for(var i=0;i<l_count;i++){l_userData[i]=l_items[i].viewed;if(l_items[i].viewed===0){l_complete=false}}this.updatePageData([-1,l_userData]);return l_complete}});