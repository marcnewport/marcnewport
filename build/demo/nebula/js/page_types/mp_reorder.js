var mp_reorder=PageType.extend({setup:function(){var l_list=$.makeArray(this.data.list.item),l_count=l_list.length,l_id="",l_savedOrder=[],$list=$$("ul","reorder-list"),l_userData=_app.session.getUserData(this.id)[2];this.data.order=[];for(var i=0;i<l_count;i++){l_id=$.randomString(6);l_list[i].id=l_id;this.data.list.item[i].id=l_id;this.data.list.item[i].order=i;this.data.order.push(l_id)}if(l_userData){for(i=0;i<l_count;i++){l_savedOrder[i]=l_list[l_userData[i]]}l_list=l_savedOrder}else{l_list.shuffle()}for(i=0;i<l_count;i++){$list.append($$("li",l_list[i].id).html(l_list[i].content))}this.html.append($$("div","","left-column column").append(this.data.scenario).append(this.data.question)).append($$("div","","right-column column").append($$("div","activity").append($list)).append($$("a","btn-submit").attr({href:"#",role:"button"}).html("Submit")));this._super()},pageReady:function(){var $list=$("#reorder-list"),$submit=$("#btn-submit"),l_submittable=false;$submit.disable();$list.sortable({placeholder:"place-holder",update:function(){if(!l_submittable){$submit.enable();l_submittable=true}}});$list.disableSelection();$list.bind("touchstart touchmove touchend touchcancel",function(e){var touches=event.changedTouches,first=touches[0],type="",simulatedEvent=document.createEvent("MouseEvent");switch(e.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup";break;default:return}simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);e.stopPropagation();e.preventDefault()});this._super()},submitAnswers:function(){this.attempts++;var scope=this,$reorder=$("#reorder-list"),$list=$reorder.find("li"),l_correct=1,l_lastAttempt=this.attempts>=this.data.max_attempts,l_index=0,l_userData=[];$("#btn-submit").disable();$reorder.sortable("disable");$list.each(function(i){l_index=scope.data.order.indexOf(this.id);l_userData[i]=l_index;if(scope.data.list.item[i].id==this.id){$(this).addClass("correct")}else{l_correct=0}});if(l_lastAttempt||l_correct){_app.$content.find("#activity").addClass("completed");$list.each(function(){var $this=$(this);if($this.hasClass("correct")){$this.prepend($$("span","","icon icon-tick"))}});if(!l_correct){_app.$feedback.find(".btn-show").show().click(function(){this.style="";scope.showCorrectOrder();_app.$feedback.trigger("hide")})}}this.updatePageData([l_correct,l_userData,this.attempts])},showCorrectOrder:function(){var scope=this,$list=$("#reorder-list"),$items=$list.find("li"),l_height=$items.eq(0).outerHeight(true);$items.each(function(i){var $this=$(this),l_offset=$this.position().top,l_order=scope.data.order.indexOf(this.id),l_position=l_order*l_height-l_offset;$this.animate({top:l_position},600)})},resetActivity:function(){this._super();var $list=_app.$content.find("#reorder-list"),l_submittable=false;_app.$content.find("#activity").removeClass("completed");$list.find(".correct").removeClass("correct");$list.sortable("enable");$list.bind("sortupdate",function(){if(!l_submittable){$("#btn-submit").enable();l_submittable=true}})},resizePage:function(){}});